######?????????????????????????? ???????????? ????????????####

library(ggplot2) #???????????????????? ?????? ????????????????????????

df <- read.csv('students.csv',sep=';') 

#???????????? ?? ??????????????????, ???????????????????? ???????????????? ???? ?????? ????????????????, ?????? ?????????? ???? ??????????????????????,???????????????????? ?????????????? ???? ?????????????? ?????????????? ???????????? ?????? ??????(N-???? ??????????????,Y-??????????????).

#?? ?????????????? ?????????????????????????? ?????????????????? ????????????????????, ?????????????? ???? ?????????????? ?? ???????????? ??????????????(??????,??????????) ?????????????? ???????????? ?????? ??????.

#???????????????? ?????????????????? ????????????:
str(df) 

#???? ?????????????????? ??????????, ?????? ???????????????????? gender ?? hon ?????????? ?????? character. ?????? ?????????????????????? ?????????????? ???????????????????? ?????????????????? ???? ?? factor:

df$gender <- as.factor(df$gender)
df$hon <- as.factor(df$hon)

#?????????????????? ???? ?????????????? ?????????????????????? ????????????????????:
pairs(df)

#??????????,?????? read,write,math ???????????? ???????????????????? ?????????? ??????????

#???????????????? ???????????????????? ?????? ????????,?????????? ???????????????????? ????????.????????????????????:
library(psych)

#?????????????????? ????????.???????????????????? ???????????? ?? ???????????????????????????? ????????????????????
cor <- corr.test(df[,2:4])

cor$r #?????????? ?????????? ?????????????????????? ?????????? ?????????? math ?? read
cor$p #???????????????????????????? ?????????????? p.value (???????????????? ???????????? ??????????????????????)

#?????? ?????????????????? ???????????????????????????????????????? ???? ?????????? ???????????????? ???????????????????? write ?? ????????????

#???????????? ???????????? ??????????????????????, ???? ?????? X -?????????? read,Y-?????????? math, ?????????????? ???????????? - female,?????????????? -  male, ???????????? ???????????????? ?????????????? ???? ???????????????????? hon:
ggplot(df,aes(read,math,col=gender))+geom_point()+facet_grid(.~hon)


#???? ?????????????? ??????????,?????? ?????????? ?????????????????????????? ?????????? read ?? math(?????? ???? ?????? ?????????????????? ????????), ???????? ?????????? ????????????????,?????? ?????????????? ???????????????? ?????????????? ???????????? ????????,?????? ??????????????

#c?????????? ?????????????????????????? ????????????:
fit <- glm(hon~gender+read+math,df,family="binomial")

summary(fit) 
#???????????? ???????????????????? ???????????????????????? ?????????? ????????????, ???? ??????????,?????? ?????? ?????????????????????? ???????????????????? ?????????? ???????????????? ???????????? (p.val<0.05)

#?????????? ?????????????? ?? ???????????????????? ???????????????? ???? ????????.?????????????????????????? ??????????????????:
fit$coefficients 

#?? ?????????????? exp ?????????? ???????????????????? ?????????????????? ????????????(odds)
exp(fit$coefficients)

#?????????????????? ?????????????????????? ???????????????? ?????????????? ???????????? ?????? ???????????? 6 ????????????????????
head(predict(fit,type="response"))

#?????????????? ?? ?????? df ???????????????????? ?? ???????????????????????? ???????????????? ?????????????? ????????????
df$prob <- predict(fit,type="response") 


#???????????? ???????????????????? ???????????????????????????????? ?????????????????????? ?? ????????????????:?????????????? ?????????????? ???????????? ?????? ??????. ?????? ?????????? ???????????????????? ?????????????? ?????????????????????? ?????????? ??????????????????????.?????????????????????????? ???????????? ROC:

library(ROCR)

#???????????? ?????????????????????? ?? ???????????????? ????????????????:
pred_fit <- prediction(df$prob,df$hon)

#???????????????????????? true positive rate ?? false positive rate:
perf_fit <- performance(pred_fit,"tpr","fpr") 

#ROC ????????????:
plot(perf_fit,colorize=T,print.cutoffs.at=seq(0.1,by=0.1),lwd=2) 

#?????????????????? ????  ?????????????? ?????? ????????????:
auc <- performance(pred_fit,measure = "auc") 

str(auc) #?????????????? 0.87 - ?????????? ???????????????? ????????????????

#???????????????? ????????????????????, ?? ?????????????? ?????????? ?????????????????????? ???????????? ?????????????????????? ?? ?????????????????????????? ????????????????????????????:
perf3 <- performance(pred_fit,x.measure = "cutoff",measure = "spec")

#?????????????????? ???? ???????????? ?????????????????????? ???????????? ?????????????????????? ?? ??????????????????????????
plot(perf3,col="red",lwd=2)

#???????????????? ????????????????????, ?? ?????????????? ?????????? ?????????????????????? ???????????? ?????????????????????? ?? ???????????????????????????????? ????????????????????????????:
perf4 <- performance(pred_fit,x.measure = "cutoff",measure = "sens")

#?????????????? ?????? ???????????? ???? ????????????
plot(add=T,perf4,col="green",lwd=2)

#???????????????? ????????????????????, ?? ?????????????? ?????????? ?????????????????????? ???????????? ?????????????????????? ?? ?????????? ?????????????????????????? ????????????????????????????:
perf5 <- performance(pred_fit,x.measure = "cutoff",measure = "acc")

#?????????? ???? ???????????? ???????????? ???? ????????????
plot(add=T,perf5,lwd=2)

#?????????????? ?????????????? ??????????????
legend(x=0.2,y=0.3,c("spec","sens","accur"),lty = 1,col=c('red','green','black'),bty='n',cex=1,lwd=2)


#???? ?????????????? ??????????, ?????? ?????? ?????? ???????????? ?????????????????????? ?? ?????????? ??????????. ???????????????? ???????????? ?????????????????????? ?? ???????? ?????????? = 0.225 - ?????? ?? ?????????? ?????????????????????? ???????????????? 

#???????????????????????? ??????????,???????????????????????????? ??????????????????????????:
abline(v=0.225,lwd=2)

#???????????? ?????????? ???????????????????????????????? ???????? ?????????????????????? ?? ???????????????? - Y ?????? N
df$pred_resp <- factor(ifelse(df$prob>0.225,1,0),labels = c("N","Y"))

#?? ?????????? ???????????????????? ?????????????????????????? ???????????????? ??????????????????  ???????????????? ??????????????

#???????????? ?????????? ?????????????? ????????????????????, ?????????????? ?????????????????? ???????? ????????????????????????:1-?????????? ??????????????????????,0 - ??????????????
df$correct <- ifelse(df$pred_resp==df$hon,1,0)

#?? ???????????????????? ?????????? ???????????????????? ?????????????? ?????????????????? ?????????????????????????? ??????????????????????:
mean(df$correct)

#?????????????? ?????????????????? ?????????????????????????? ???????????????? ?????????? 76.7 (?????? ?????????? ?????????? ???? ROC ???????????? ?????? ???????????? 0.225)

#???????????? ?????????? ?????????????????? ???????? ???????????? ???? ???????????????? ????????????

#???????????????? ???????????????? ???????????? ?????????? ???? ??????????????????, ?????? ?? ?????? ???????????????? df
test_df <- read.csv("test.csv",sep=";")

#???????????????????? ???????????????? Y ?? N ?????? ???????????????? ????????????:
test_df$hon_pred <- predict(fit,newdata = test_df,type="response")
test_df$hon_pred <- factor(ifelse(test_df$hon_pred>0.225,1,0),labels = c("N","Y"))

#???????????????? ???????? ?????????????????????????? ????????????????
test_df$correct <- ifelse(test_df$hon==test_df$hon_pred,1,0)
mean(test_df$correct)

#?????????????? ?????????????????? ?????????????????????????? ???????????????? ?????????? 74
